<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendário de Agendamentos</title>

    <!-- Importa o CSS do FullCalendar (versão 6.x) a partir da pasta local -->
    <link href="fullcalendar-6.1.15/css/main.min.css" rel="stylesheet">
    <link href="fullcalendar-6.1.15/css/daygrid.min.css" rel="stylesheet">

    <!-- Importa as bibliotecas do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>

    <!-- Importa o JS do FullCalendar (versão 6.x) a partir da pasta local -->
    <script src="fullcalendar-6.1.15/js/main.min.js"></script>
    <script src="fullcalendar-6.1.15/js/daygrid.min.js"></script>
</head>

<body>
    <!-- Elemento onde o calendário será renderizado -->
    <div id="calendar"></div>

    <!-- Aqui começam os scripts do Firebase e FullCalendar -->
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCviZ-ql0st4L0Ii3BTIg1xgin5IGJeBt0",
            authDomain: "capitaobarbeiro-5b7be.firebaseapp.com",
            projectId: "capitaobarbeiro-5b7be",
            storageBucket: "capitaobarbeiro-5b7be.appspot.com",
            messagingSenderId: "1013857162216",
            appId: "1:1013857162216:web:d3d74fa8be916691174a5d",
            measurementId: "G-DMR6NG64B3"
        };

        // Inicializa o Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');

            // Inicializa o FullCalendar com a versão local
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'pt-br',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },

                events: function(info, successCallback, failureCallback) {
                    // Buscar eventos do Firestore
                    db.collection("Agendamento").get().then((querySnapshot) => {
                        var events = [];
                        querySnapshot.forEach((doc) => {
                            var data = doc.data();

                            // Conversão de Timestamp (data)
                            var eventStart = data.data.toDate();  // Convertendo o timestamp para objeto Date
                            var eventStartISO = eventStart.toISOString();  // Convertendo para formato ISO 8601

                            // Evento a ser adicionado no FullCalendar
                            var event = {
                                title: data.Nome_Usuario,  // Nome do cliente
                                start: eventStartISO,  // Data e hora de início convertida
                                extendedProps: {
                                    barbeiro: data.barbeiro,
                                    telefone: data.Telefone_Usuario,
                                    status: data.status,
                                    servicos: data.servicos.join(", ")  // Lista de serviços
                                }
                            };
                            events.push(event);
                        });
                        successCallback(events);  // Adiciona os eventos ao calendário
                    });
                },

                eventClick: function(info) {
                    // Exibe as informações adicionais do evento ao clicar
                    alert(
                        "Cliente: " + info.event.title + "\n" +
                        "Barbeiro: " + info.event.extendedProps.barbeiro + "\n" +
                        "Telefone: " + info.event.extendedProps.telefone + "\n" +
                        "Status: " + info.event.extendedProps.status + "\n" +
                        "Serviços: " + info.event.extendedProps.servicos
                    );
                }
            });

            calendar.render();
        });
    </script>
</body>
</html>
